# Алгоритм шифрования

## Общее описание
Алгоритм выполняет рекурсивное шифрование файлов и директорий, начиная с указанной папки, с сохранением структуры через зашифрованные имена.

## Шаги выполнения

### 1. Генерация ключа шифрования
- Создать криптографический ключ симметричного шифрования
- Ключ будет использоваться для шифрования как содержимого файлов, так и путей

### 2. Сохранение ключа
- Определить родительскую директорию для `folderPath`
- Создать файл `key.enc` в этой родительской директории
- Сохранить сгенерированный ключ в файл `key.enc`

### 3. Рекурсивный обход файловой структуры
- Начать обход с корневой директории `folderPath`
- Рекурсивно собрать полный список всех файлов во всех поддиректориях
- Игнорировать пустые директории

### 4. Обработка каждого файла
Для каждого файла из списка выполнить последовательно:

#### 4.1. Получение относительного пути
- Вычислить относительный путь файла относительно `folderPath`
- Пример: если `folderPath = "/data"` и файл `/data/docs/file.txt`, то относительный путь = `"docs/file.txt"`

#### 4.2. Шифрование пути
- Зашифровать относительный путь с использованием ключа шифрования
- Преобразовать результат шифрования в формат base64 для безопасного использования в качестве имени файла
- Заменить символы, которые не могут быть в пути файла. Символы должны быть восстановимы

#### 4.3. Создание зашифрованного файла
- Создать новый файл по пути: `folderPath + "/" + зашифрованный_base64_путь`
- Изначально файл создается пустым

#### 4.4. Шифрование содержимого
- Прочитать содержимое исходного файла
- Зашифровать содержимое с использованием того же ключа шифрования
- Записать зашифрованные данные в созданный файл

#### 4.5. Удаление оригинала
- Удалить исходный файл после успешного шифрования
- Проверить родительскую директорию удаленного файла:
  - Если в директории остались другие файлы - оставить директорию
  - Если директория пуста - удалить директорию
- Рекурсивно проверять и удалять пустые родительские директории до достижения `folderPath`

## Особенности алгоритма
- Сохраняет древовидную структуру через зашифрованные имена
- Автоматически очищает пустые директории
- Использует единый ключ для всего процесса шифрования
- Преобразует иерархию директорий в плоскую структуру зашифрованных файлов

# Алгоритм дешифрования

## Общее описание
Алгоритм восстанавливает исходную структуру файлов и директорий из зашифрованного состояния, используя сохраненный ключ.

## Шаги выполнения

### 1. Загрузка ключа дешифрования
- Найти файл `key.enc` в родительской директории относительно `folderPath`
- Загрузить криптографический ключ из файла `key.enc`

### 2. Сканирование зашифрованных файлов
- Получить список всех файлов в директории `folderPath`
- Игнорировать поддиректории

### 3. Обработка каждого зашифрованного файла
Для каждого файла в `folderPath` выполнить последовательно:

#### 3.1. Дешифрование пути
- Взять имя файла (зашифрованный путь в base64)
- Восстановить base64, т.к. при шифровании были заменены символы, которые запрещены в названии файла (см. 4.2 из алгоритма шифрования)
- Декодировать из base64
- Дешифровать полученные данные с использованием ключа для восстановления исходного относительного пути

#### 3.2. Восстановление структуры директорий
- На основе восстановленного относительного пути определить полный путь к файлу: `folderPath + "/" + относительный_путь`
- Создать все необходимые родительские директории для этого пути
- Пример: если восстановленный путь = `"docs/subfolder/file.txt"`, создать директории `docs` и `docs/subfolder`

#### 3.3. Дешифрование содержимого
- Прочитать зашифрованные данные из текущего файла
- Дешифровать данные с использованием ключа
- Создать файл по восстановленному пути и записать в него дешифрованные данные

#### 3.4. Удаление зашифрованного файла
- После успешного дешифрования и сохранения файла удалить оригинальный зашифрованный файл из `folderPath`

### 4. Очистка
- После обработки всех файлов проверить, что директория `folderPath` пуста
- Если в `folderPath` остались файлы, вывести предупреждение о возможных ошибках

## Особенности алгоритма
- Восстанавливает исходную иерархию директорий на основе зашифрованных путей
- Автоматически создает необходимую структуру папок
- Использует тот же ключ, что и при шифровании
- Сохраняет исходные имена файлов и структуру путей
- Обеспечивает атомарность операции (файл удаляется только после успешного восстановления)

## Обработка ошибок
- Если дешифрование пути невозможно - пропустить файл и продолжить
- Если невозможно создать директорию - прервать операцию для этого файла
- Если дешифрование содержимого не удалось - оставить зашифрованный файл на месте
